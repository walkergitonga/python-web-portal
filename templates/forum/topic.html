{% extends 'base.html' %}

{% load i18n %}
{% load static %}
{% load photo %}

{% block extra_js %}
    {{form_comment.media.js}}
{% endblock %}

{% block content %}
	
<div class="container">
  <div class="row">
    <div class="col-md-12">
        <h2>{% trans "Forum" %}: <a href="/forum/{{topic.forum.name}}">{{topic.forum.name}}</a></h2>
        <p>{{topic.forum.description|safe}}</p>
        <hr>
        <section class="comment-list">
          <!-- First Comment -->
          <article class="row">
            <div class="col-md-2 col-sm-2 hidden-xs">
              <figure class="thumbnail">
              	{% if field_photo %}
	                <img src="{{MEDIA_URL}}{{field_photo}}" class="img-responsive" width="150" hegiht="150" />
	              {% else %}
	                <img src="{% static 'img/profile.png' %}" class="img-responsive" width="150" hegiht="150" />
	              {% endif %}
                <figcaption class="text-center"><a href="{{URL_PROFILE}}{{topic.user.username}}/">{{topic.user.username}}</a></figcaption>
              </figure>
              <a href="/edit_topic/{{topic.forum.name}}/{{topic.idtopic}}/" class="btn btn-success btn-xs">{% trans "Edit topic" %}</a>
              <a style="cursor: pointer" data-toggle="modal" data-target="#myModal" class="btn btn-danger btn-xs">{% trans "Delete topic" %}</a>
            </div>
            <div class="col-md-10 col-sm-10">
              <div class="panel panel-default arrow left">
                <div class="panel-body">
                  <header class="text-left">
                    <h4><i class="fa fa-clock-o"></i> {{topic.title}}</h4>
                  </header>
                  <div class="comment-post">
                    <p>
                      {{topic.description|safe}}

                      {% if topic.attachment %}
                        <img src="{{MEDIA_URL}}{{topic.attachment}}" class="img-responsive" />
                      {% endif %}
                    </p>
                  </div>
                  <hr>
                  <p class="pull-right">{{topic.date}}</p>
                </div>
              </div>
            </div>
          </article>
        </section>
    </div>
  </div>

  <hr>

  <!-- Modal Comments-->
  {% for comment in comments %}
    <article class="row">
      <div class="col-md-1 col-sm-1 hidden-xs">
        <figure class="thumbnail">
          <img class="img-responsive" src="{{comment.user.id|get_photo}}"/>
          <figcaption class="text-center"><a href="{{URL_PROFILE}}{{comment.user.username}}">{{comment.user.username}}</a></figcaption>
        </figure>
      </div>
      <div class="col-md-10 col-sm-10">
        <div class="panel panel-default arrow left">
          <div class="panel-body">
            <header class="text-left">
              <time class="comment-date" datetime="16-12-2014 01:05"><i class="glyphicon glyphicon-time"></i> {{comment.date}}</time>
            </header>
            <div class="comment-post">
              <div class="well" style="margin-top: 5px">
                {{comment.description|safe}}
              </div>
            </div>
            {% if comment.user.id == user.id %}
              <div class="span4 offset4 text-right">
                <a style="cursor: pointer" data-toggle="modal" data-target="#myModal_{{comment.idcomment}}" class="btn btn-default btn-sm">
                  <i class="glyphicon glyphicon-hand-up"></i> {% trans "Edit" %}</a>

                <a style="cursor: pointer" data-toggle="modal" data-target="#myModal_{{comment.idcomment}}_remove" class="btn btn-default btn-sm">
                  <i class="glyphicon glyphicon-trash"></i> {% trans "Remove" %}</a>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </article>

    <!-- Modal edit comment -->
    <div class="modal fade" id="myModal_{{comment.idcomment}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">{% trans "Edit comment" %}</h4>
          </div>
          <div class="modal-body">
                
            <form class="form-horizontal" action="/updatecomment/{{topic.forum.name}}/{{topic.slug}}/{{topic.idtopic}}/{{comment.idcomment}}/" method="POST">{% csrf_token%}
                <textarea name="update_description" style="width: 100%">
                  {{comment.description|safe}}
                </textarea> 
              <br>
              <input type="submit" class="btn btn-success" value='{% trans "Edit comment" %}' />
            </form>

          </div>
        </div>
      </div>
    </div>

    <!-- Modal remove comment -->
    <div class="modal fade" id="myModal_{{comment.idcomment}}_remove" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">{% trans "Remove comment" %}</h4>
          </div>
          <div class="modal-body">
            <p>{% trans "Do you want remove this comment?" %}</p>
          </div>
          <div class="modal-footer">
              <form class="form-horizontal" action="/removecomment/{{topic.forum.name}}/{{topic.slug}}/{{topic.idtopic}}/{{comment.idcomment}}/" method="POST">{% csrf_token%}
              <input type="submit" class="btn btn-danger" value='{% trans "Remove comment" %}' />
            </form>
          </div>
        </div>
      </div>
    </div>

  {% endfor %}

  {% if comments.count > 0 %}
  <hr>
  {% endif %}

  <!-- New comment-->
  {% if user.id != None %}
    <div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8">
      {% for message in messages %}
        {% if message.tags != "error" %}
          <div class="alert alert-success" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
            {{ message }}
          </div>
        {% else %}
          <div class="alert alert-danger" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
            {{ message }}
          </div>
        {% endif %}
      {% endfor %}
      <form class="form-horizontal" action="/newcomment/{{topic.forum.name}}/{{topic.slug}}/{{topic.idtopic}}/" method="POST">{% csrf_token%}
        <center>
        {% for field in form_comment %}
          {% if field.name == "description" %}
              {{ field }}
              {% if form_comment.description.errors %}
                <div style="color: red">{{ form_comment.description.errors }}</div>

              {% endif %}
          {% endif %}
        {% endfor %}
        </center>
        <br>
        <input type="submit" class="btn btn-success" value='{% trans "New comment" %}' />
      </form>
    </div>
    <div class="col-md-2"></div>
    </div>
  {% endif %}
  

</div>

{% if topic.user.id == user.id %}

    <!-- Modal edit topic-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">{% trans "Delete topic" %}</h4>
          </div>
          <div class="modal-body">
            {% trans "Do you want to remove the topic?" %}
          </div>
          <div class="modal-footer">
            <form accept-charset="UTF-8" action="/delete_topic/{{topic.forum.name}}/{{topic.idtopic}}/" method="GET">
              <input type="submit" class="btn btn-danger" value='{% trans "Delete" %}' />
          </form>
          </div>
        </div>
      </div>
    </div>

{% endif %}

{% endblock %}